{template '_header'}
{if $_W[method] == 'album'}
<div class="page-heading"> 
    <span class='pull-right'>
        {ifp 'shop.section.add'}
        	<a class='btn btn-primary btn-sm' href="{php echo webUrl('shop/section/albumEdit', array('sid' => $sid))}"><i class='fa fa-plus'></i> 添加图位</a>
        {/if}
    </span>
    <h2>图位管理</h2> 
</div>

<form action="./index.php" method="get" class="form-horizontal form-search" role="form">
    <input type="hidden" name="c" value="site" />
    <input type="hidden" name="a" value="entry" />
    <input type="hidden" name="m" value="ewei_shopv2" />
    <input type="hidden" name="do" value="web" />
    <input type="hidden" name="r"  value="shop.section.album" />
    <div class="page-toolbar row m-b-sm m-t-sm">
        <div class="col-sm-4">
            <div class="input-group-btn">
                <button class="btn btn-default btn-sm"  type="button" data-toggle='refresh'><i class='fa fa-refresh'></i></button>
                {ifp 'shop.section.edit'}
                	<button class="btn btn-default btn-sm" type="button" data-toggle='batch' data-href="{php echo webUrl('shop/section/enabled',array('enabled'=>1))}"><i class='fa fa-circle'></i> 显示</button>
                	<button class="btn btn-default btn-sm" type="button" data-toggle='batch'  data-href="{php echo webUrl('shop/section/enabled',array('enabled'=>0))}"><i class='fa fa-circle-o'></i> 隐藏</button>
                {/if}
                {ifp 'shop.section.delete'}	
                	<button class="btn btn-default btn-sm" type="button" data-toggle='batch-remove' data-confirm="确认要删除?" data-href="{php echo webUrl('shop/section/delete')}"><i class='fa fa-trash'></i> 删除</button>
                {/if}
            </div> 
        </div>	

        <div class="col-sm-6 pull-right">

            <select name="enabled" class='form-control input-sm select-sm'>
                <option value="" {if $_GPC['enabled'] == ''} selected{/if}>状态</option>
                <option value="1" {if $_GPC['enabled']== '1'} selected{/if}>显示</option>
                <option value="0" {if $_GPC['enabled'] == '0'} selected{/if}>隐藏</option>
            </select>	
             <select name='sid' class='form-control input-sm select-sm' style="width:150px;">
                          <option value="">
                            版块
                          </option>
                          {loop $sections $row}
                          <option value="{$row['sid']}" {if $_GPC['sid']==$row['sid']}selected="selected"{/if}>{$row['section_name']}</option>
                          {/loop}
                        </select>
            <div class="input-group">				 
                <input type="text" class="input-sm form-control" name='keyword' value="{$_GPC['keyword']}" placeholder="请输入关键词"> 
                <span class="input-group-btn">
                	<button class="btn btn-sm btn-primary" type="submit"> 搜索</button> 
                </span>
            </div>
        </div>
        
    </div>
</form>

<form action="" method="post">
    {if count($list)>0}
    <table class="table table-responsive table-hover" >
        <thead class="navbar-inner">
            <tr>
                <th style="width:25px;"><input type='checkbox' /></th>
                <th style="width:80px;">显示顺序</th>			
                <th width="20%">图位名称</th>
                <th width="20%">标题<br>副标题</th>
                <th>关联的数据ID</th>
                <th>尺寸</th>
                <th>状态</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            {loop $list $row}
            <tr>
                <td>
                    <input type='checkbox'   value="{$row['item_id']}"/>
                </td>
                <td>
                    {ifp 'shop.section.edit'}
                    	<a href='javascript:;' data-toggle='ajaxEdit' data-href="{php echo webUrl('shop/section/albumOrder',array('id'=>$row['item_id']))}" >{$row['displayorder']}</a>
                    {else}
                    	{$row['displayorder']} 
                    {/if}
                </td>
                <td>{if $row['thumb']}<img src="{$row['thumb']}" height="40px;" width="auto;"><br>{/if}{$row['name']}</td>
                <td>{$row['title']}<br>{$row['assistant_title']}</td>
                <td><span class='label label-success'>{$row['data_id']}</span></td>
                <td>宽:{$row['width']}<br>高：{$row['height']}</td>
                <td>
                	<span class='label {if $row['enabled']==1}label-success{else}label-default{/if}' 
                          {ifp 'shop.section.edit'}
	                          data-toggle='ajaxSwitch' 
	                          data-switch-value='{$row['enabled']}'
	                          data-switch-value0='0|隐藏|label label-default|{php echo webUrl('shop/section/albumEnabled',array('enabled'=>1,'id'=>$row['item_id']))}'  
	                          data-switch-value1='1|显示|label label-success|{php echo webUrl('shop/section/albumEnabled',array('enabled'=>0,'id'=>$row['item_id']))}'  
                          {/if} >
                          {if $row['enabled']==1}显示{else}隐藏{/if}
                    </span>
                </td> 
                <td style="text-align:left;">
                        
                        {ifp 'shop.section.view|shop.section.edit'}
                        	<a href="{php echo webUrl('shop/section/albumEdit', array('id' => $row['item_id'], 'sid' => $sid))}" class="btn btn-default btn-sm" >
                        		<i class='fa fa-edit'></i> {ifp 'shop.section.edit'}修改{else}查看{/if}
                        	</a>
                        {/if}
                        
                        {ifp 'shop.section.delete'}
                        	<br><a data-toggle='ajaxRemove' href="{php echo webUrl('shop/section/albumDel', array('id' => $row['item_id'], 'sid' => $sid))}" class="btn btn-default btn-sm" data-confirm='确认要删除此图位吗?'><i class="fa fa-trash"></i> 删除</a>
                        {/if}
                        
                </td>
            </tr>
                {/loop} 
                <tr>
                    <td colspan='8'>
                        <div class='pagers' style='float:right;'>
                            {$pager}			
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        {$pager}
        {else}
        <div class='panel panel-default'>
            <div class='panel-body' style='text-align: center;padding:30px;'>
                暂时没有任何图位!
            </div>
        </div>
        {/if}
    </form>
{else}
<div class="page-heading"> 
	<span class='pull-right'>
		{ifp 'shop.section.add'}
			<a class="btn btn-primary btn-sm" href="{php echo webUrl('shop/section/albumEdit')}">添加新图位</a>
		{/if}
		<a class="btn btn-default  btn-sm" href="{php echo webUrl('shop/section/album', array('sid' => $sid))}">返回列表</a>
	</span>
	<h2>{if !empty($item['item_id'])}编辑{else}添加{/if}图位 <small>{if !empty($item['item_id'])}修改【{$item['name']}】{/if}</small></h2> 
</div>
 
    <form {ife 'shop.section' $item}action="" method="post"{/if} class="form-horizontal form-validate" enctype="multipart/form-data">
        <input type="hidden" name="id" value="{$item['item_id']}" />
                <div class="form-group">
                    <label class="col-sm-2 control-label">排序</label>
                    <div class="col-sm-9 col-xs-12">
                        {ife 'shop.section' $item}
                                <input type="text" name="displayorder" class="form-control" value="{$item['displayorder']}" />
                                <span class='help-block'>数字越大，排名越靠前</span>
                        {else}
                            <div class='form-control-static'>{$item['displayorder']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label must">图位名称</label>
                    <div class="col-sm-9 col-xs-12 ">
                         {ife 'shop.section' $item}
                        	<input type="text" id='name' name="name" class="form-control" value="{$item['name']}" data-rule-required="true" />
                         {else}
                        	<div class='form-control-static'>{$item['name']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">标题</label>
                    <div class="col-sm-9 col-xs-12 ">
                         {ife 'shop.section' $item}
                        	<input type="text" id='title' name="title" class="form-control" value="{$item['title']}" />
                            <span class="help-block">显示在网页上的主要文字</span>
                         {else}
                        	<div class='form-control-static'>{$item['title']}</div>
                        {/if}
                    </div>
                </div>
                 <div class="form-group">
                    <label class="col-sm-2 control-label">副标题</label>
                    <div class="col-sm-9 col-xs-12 ">
                         {ife 'shop.section' $item}
                        	<input type="text" id='assistant_title' name="assistant_title" class="form-control" value="{$item['assistant_title']}" />
                            <span class="help-block">显示在网页上的描述文字</span>
                         {else}
                        	<div class='form-control-static'>{$item['assistant_title']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label must">所属版块</label>
                    <div class="col-sm-9 col-xs-12">
                        <select class="form-control" name="section_id" id="section_id">
                            <option value="">请选择</option>
                            {loop $sections $v}
                            <option value="{$v['sid']}"{if $item['section_id']==$v['sid'] || $sid == $v['sid']} selected{/if}>{$v['section_name']}{if $v['type']}({$v['type']}){/if}</option>
                            {/loop}
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">图片</label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
	                        {php echo tpl_form_field_image('thumb', $item['thumb'])}
                        {else}
                            {if !empty($item['thumb'])}
                            	<a href='{php echo tomedia($item['thumb'])}' target='_blank'>
                            		<img src="{php echo tomedia($item['thumb'])}" style='width:100px;border:1px solid #ccc;padding:1px' />
                            	</a>
                            {/if}
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">背景颜色</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='bgcolor' name="bgcolor" class="form-control" value="{$item['bgcolor']}" />
                        <div class='form-control-static'><span class="color-box" {if $item['bgcolor']}style='background:{$item['bgcolor']}'{/if}></span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">尺寸</label>
                    <div class="col-sm-9 col-xs-12">
                        宽度：<input type="text" id='width' name="width" value="{$item['width']}" />px &nbsp; 
                        高度： <input type="text" id='height' name="height" value="{$item['height']}" />px
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">关联数据ID</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='data_id' name="data_id" class="form-control" value="{$item['data_id']}" />
                        <div class='form-control-static'><span class="res-alert"></span>
                        <span class="help-block">填写关联到的数据ID，点击图位默认链接到相关数据</span></div>
 
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">图位链接</label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
                    		<div class="input-group form-group" style="margin: 0;">
                    			<input type="text" value="{$item['link']}" class="form-control valid" name="link" placeholder="" id="sectionlink">
                    				<span data-input="#sectionlink" data-toggle="selectUrl" class="input-group-addon btn btn-default">选择链接</span>
                    		</div>
                        {else}
                            
                        	<div class='form-control-static'>{$item['link']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">描述</label>
                    {ife 'shop.section' $item}
                    <div class="col-sm-9 col-xs-12">
                        <textarea name='desc' class="form-control">{$item['desc']}</textarea>
                    </div>
                    {else}
                        <div class='form-control-static'>{$item['desc']}</div>
                    {/if}
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">状态</label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
                    		<label class='radio-inline'>
                            	<input type='radio' name='enabled' value=1' {if $item['enabled']==1}checked{/if} /> 显示
                            </label>
                        	<label class='radio-inline'>
                        		<input type='radio' name='enabled' value=0' {if $item['enabled']==0}checked{/if} /> 隐藏
                        	</label>
                        {else}
                            <div class='form-control-static'>{if empty($item['enabled'])}隐藏{else}显示{/if}</div>
                        {/if}
                    </div>
                </div>
            		
            <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
                    		<input type="submit" value="提交" class="btn btn-primary"  />
                    	{/if}
                       <input type="button" name="back" onclick='history.back()' {ifp 'shop.section.add|shop.section.edit'}style='margin-left:10px;'{/if} value="返回列表" class="btn btn-default" />
                    </div>
            </div>
 
    </form>
 

<script language='javascript'>
    function formcheck() {
        if ($("#name").isEmpty()) {
            Tip.focus("name", "请填写图位名称!");
            return false;
        }
        return true;
    }
</script>
{/if}
{template '_footer'}