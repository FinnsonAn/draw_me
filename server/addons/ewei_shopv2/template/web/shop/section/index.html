{template '_header'}
{if !$_W[method]}
<div class="page-heading"> 
    <span class='pull-right'>
        {ifp 'shop.section.add'}
        	<a class='btn btn-primary btn-sm' href="{php echo webUrl('shop/section/edit')}"><i class='fa fa-plus'></i> 添加版块</a>
        {/if}
    </span>
    <h2>版块管理</h2> 
</div>
<form action="./index.php" method="get" class="form-horizontal form-search" role="form">
    <input type="hidden" name="c" value="site" />
    <input type="hidden" name="a" value="entry" />
    <input type="hidden" name="m" value="ewei_shopv2" />
    <input type="hidden" name="do" value="web" />
    <input type="hidden" name="r"  value="shop.section.plist" />
</form>

<form action="" method="post">
    {if count($list)>0}
    <table class="table table-responsive table-hover" >
         <tr>
            <th style="width:50px;">ID</th>	
            <th style='width:80px'>显示顺序</th>	
            <th>版块</th>
            <th>标题</th>
            <th>类型</th>
            <th>包含图位</th>
            <th>状态</th>
            <th>操作</th>
        </tr>
        <tbody>
                {loop $list $row}
                <tr>
                    <td>{$row['sid']}</td>
                    <td>{ifp 'shop.section.edit'}
                    	<a href='javascript:;' data-toggle='ajaxEdit' data-href="{php echo webUrl('shop/section/displayorder',array('id'=>$row['sid']))}" >{$row['displayorder']}</a>
                    {else}
                    	{$row['displayorder']} 
                    {/if}</td>
                    <td>{$row['section_name']}</td>
                    <td>{$row['section_title']}</td>
                    <td><span class='label label-success'>{$row['type']}</span></td>
                    <td><a href="{php echo webUrl('shop/section/album', array('sid' => $row['sid']))}" class="btn btn-default btn-sm" title="查看图位">查看图位({$row['counts']})</a></td>
                    <td>
                                    {if $row['enabled']==1}
                                    <span class='label label-success'>显示</span>
                                    {else}
                                    <span class='label label-danger'>隐藏</span>
                                    {/if}
                    </td>
                    <td style="text-align:left;">
                        {ifp 'shop.section.view|shop.section.edit'}
                        &nbsp; 
                        <a href="{php echo webUrl('shop/section/edit', array('id' => $row['sid']))}" class="btn btn-default btn-sm" title="{ifp 'shop.section.edit'}修改{else}查看{/if}"><i class="fa fa-edit"></i></a>{/if}
                        {if !$row['is_system']}{ifp 'shop.section.delete'}<a data-toggle='ajaxRemove' href="{php echo webUrl('shop/section/delete', array('id' => $row['sid']))}" class="btn btn-default btn-sm" data-confirm='确认删除此版块吗，连同包括的也会一起删除?'><i class="fa fa-times"></i></a>{/if}{/if}
                    </td>
                </tr>
                {/loop} 
                <tr>
                    <td colspan='8'>
                        {ifp 'shop.section.add'}
                          <a class='btn btn-primary' href="{php echo webUrl('shop/section/edit')}"><i class='fa fa-plus'></i> 添加版块</a>
                       {/if}
                    </td>
                </tr>
            </tbody>
        </table>
        {else}
        <div class='panel panel-default'>
            <div class='panel-body' style='text-align: center;padding:30px;'>
                暂时没有任何版块!
            </div>
        </div>
        {/if}
    </form>

{elseif $_W[method] == 'edit'}
<div class="page-heading"> 
	<span class='pull-right'>
		{ifp 'shop.section.add'}
			<a class="btn btn-primary btn-sm" href="{php echo webUrl('shop/section/edit')}">添加新版块</a>
		{/if}
		<a class="btn btn-default  btn-sm" href="{php echo webUrl('shop/section')}">返回列表</a>
	</span>
	<h2>{if !empty($item['sid'])}编辑{else}添加{/if}版块 <small>{if !empty($item['sid'])}修改【{$item['section_name']}】{/if}</small></h2> 
</div>
 
    <form {ife 'shop.section' $item}action="" method="post"{/if} class="form-horizontal form-validate" enctype="multipart/form-data">
        <input type="hidden" name="id" value="{$item['sid']}" />
         		<div class="form-group">
                    <label class="col-sm-2 control-label">排序</label>
                    <div class="col-sm-9 col-xs-12">
                        {ife 'shop.section' $item}
                                <input type="text" name="displayorder" class="form-control" value="{$item['displayorder']}" />
                                <span class='help-block'>数字越大，排名越靠前</span>
                        {else}
                            <div class='form-control-static'>{$item['displayorder']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label must">版块名称</label>
                    <div class="col-sm-9 col-xs-12 ">
                         {ife 'shop.section' $item}
                        	<input type="text" id='section_name' name="section_name" class="form-control" value="{$item['section_name']}" data-rule-required="true" />
                         {else}
                        	<div class='form-control-static'>{$item['section_name']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">版块标题</label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
	                        <input type="text" id='section_title' name="section_title" class="form-control" value="{$item['section_title']}" />
                        {else}
                            <div class='form-control-static'>{$item['size']}</div>
                        {/if}
                    </div>
                </div>
               <div class="form-group">
                    <label class="col-sm-2 control-label">版块类型</label>
                    <div class="col-sm-9 col-xs-12">
                         {ife 'shop.section' $item}
                        <select class="form-control" name="section_type" id="section_type">
                            <option value="">请选择</option>
                            {loop $section_types $k $val}
                            <option value="{$k}" {if $k == $item['section_type']}selected=""{/if}>{$val}</option>
                            {/loop}
                        </select>
                         {else}
                        <div class='form-control-static'>{$item['section_type']}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">版块样式(Wap端)</label>
                    <div class="col-sm-9 col-xs-12">
                         {ife 'shop.section' $item}
                        <select class="form-control" name="style" id="style">
                            <option value="">请选择</option> 
                            {loop $styles $k $style}
                            <option value="{$k}" {if $k == $item['style']}selected{/if}>{$style}</option>
                            {/loop}
                        </select>
                         {else}
                        <div class='form-control-static'>{php echo m('shop')->getSectionStyle($item['style'])}</div>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">链接地址</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='link' name="link" class="form-control" value="{$item['link']}" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">关联的幻灯片ID</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='slider_id' name="slider_id" class="form-control" value="{$item['slider_id']}" />
                    </div>
                </div>
                 <div class="form-group">
                    <label class="col-sm-2 control-label">样式名(css)</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='classname' name="classname" class="form-control" value="{$item['classname']}" />
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">背景颜色</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" id='bgcolor' name="bgcolor" class="form-control" value="{$item['bgcolor']}" />
                        <div class='form-control-static'><span class="color-box" {if $item['bgcolor']}style='background:{$item['bgcolor']}'{/if}></span></div>
 
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">状态</label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
                    		<label class='radio-inline'>
                            	<input type='radio' name='enabled' value=1' {if $item['enabled']==1}checked{/if} /> 显示
                            </label>
                        	<label class='radio-inline'>
                        		<input type='radio' name='enabled' value=0' {if $item['enabled']==0}checked{/if} /> 隐藏
                        	</label>
                        {else}
                            <div class='form-control-static'>{if empty($item['enabled'])}隐藏{else}显示{/if}</div>
                        {/if}
                    </div>
                </div>
            
            <div class="form-group">
                    <label class="col-sm-2 control-label"></label>
                    <div class="col-sm-9 col-xs-12">
                    	{ife 'shop.section' $item}
                    		<input type="submit" value="提交" class="btn btn-primary"  />
                    	{/if}
                       <input type="button" name="back" onclick='history.back()' {ifp 'shop.section.add|shop.section.edit'}style='margin-left:10px;'{/if} value="返回列表" class="btn btn-default" />
                    </div>
            </div>
 
    </form>
 

<script language='javascript'>
    function formcheck() {
        if ($("#section_name").isEmpty()) {
            Tip.focus("section_name", "请填写版块名称!");
            return false;
        }
        return true;
    }
	
	$(function(){
	    $('#bgcolor').blur(function(){
			var $color = $(this).val();
			if ($color != '')
			{
				$('.color-box').css("background", $color);
			}
			else
			{
				$('.color-box').css("background", "#fff");
			}
		});	
	});
</script>
{/if}
    {template '_footer'}